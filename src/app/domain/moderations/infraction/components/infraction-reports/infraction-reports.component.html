<ng-template #statusTemplate let-item>
  <span
    class="badge p-2 border"
    [ngClass]="{
      'text-secondary': item.infraction_status === 'CREATED',
      'border-secondary': item.infraction_status === 'CREATED',
      'text-success': item.infraction_status === 'APPROVED',
      'border-success': item.infraction_status === 'APPROVED',
      'text-danger': item.infraction_status === 'REJECTED',
      'border-danger': item.infraction_status === 'REJECTED',
      'border-warning': item.infraction_status === 'ON_APPEALING',
      'text-warning': item.infraction_status === 'ON_APPEALING'
    }"
    >{{
      item.infraction_status | getValueByKeyForEnum : InfractionStatusEnum
    }}</span
  >
</ng-template>

<ng-template #dateTemplate let-item>
  {{ item.created_date | date : "dd/MM/yyyy HH:mm" }}
</ng-template>

<ng-template #fineTemplate let-item>
  @if (item.fine_id) {
  <a [href]="['/fine/' + item.fine_id]">
    {{ item.fine_id }}
  </a>
  }@else { N/A }
</ng-template>

<app-main-container title="Reporte de Infracciones" (infoButtonClick)="infoModal()">
  <div class="d-flex justify-content-center gap-3">
    <div class="w-25">
      <app-table
        [items]="(items$ | async) || []"
        [columns]="columns"
        [isLoading]="(isLoading$ | async) || false"
        [showHeaderButton]="false"
        [showExportOptions]="false"
        [showSearchBar]="false"
        [showOnlyTableFilters]="true"
        [tableFilters]="filterConfig"
        (filterValueChange)="onFilterValueChange($event)"
      ></app-table>
    </div>
    <div class="w-75 card" style="height: 614px">
      <div class="card-body d-flex flex-column gap-3">
        <div class="w-100 pb-5 h-50 d-flex gap-4">
          <!-- GrÃ¡fico de Torta -->
          <div class="w-100">
            <h5 class="text-center mb-3">Infracciones por Estado</h5>
            <div class="w-100 d-flex justify-content-center">
              <canvas
                baseChart
                height="220px"
                [type]="'pie'"
                [datasets]="pieChartStatusDatasets"
                [labels]="pieChartStatusLabels"
                [options]="pieChartOptions"
                [plugins]="pieChartPlugins"
                [legend]="pieChartLegend"
              >
              </canvas>
            </div>
          </div>
        </div>
        <div class="w-100 h-50">
          <div class="">
            <h5 class="text-center mb-3">Infracciones por Lote</h5>
            <div class="w-100 d-flex justify-content-center">
              <canvas
                width="900px"
                height="230px"
                baseChart
                [data]="barChartPlotData"
                [options]="barChartOptions"
                [plugins]="barChartPlugins"
                [legend]="barChartLegend"
                [type]="'bar'"
              >
              </canvas>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</app-main-container>
