<ng-template #fineState let-item>
  {{ item.fine_state | getValueByKeyForEnum : FineStatusEnum }}
</ng-template>

<ng-template #fineDate let-item>
  {{ item.created_date | date : "dd/MM/yyyy" }}
</ng-template>

<ng-template #actionsTemplate let-item>
  <button class="btn btn-primary btn-sm me-2" (click)="viewDetail(item.id)">
    Ver m√°s
  </button>
</ng-template>




<app-main-container title="Multas" id="pdf-template">
  <app-table
    [items]="(fines$ | async) || []"
    [columns]="columns"
    [pagination]="{
      totalItems: (service.total$ | async) || 0,
      page: service.page,
      size: service.pageSize,
      onPageChange: onPageChange,
      onPageSizeChange: onPageSizeChange
    }"
    [isLoading]="(service.loading$ | async) || false"
    (searchValueChange)="onSearchValueChange('partialName', $event)"
    searchPlaceHolder="Lote..."
    (excelButtonClick)="onExportToExcel()"
    (pdfButtonClick)="onExportToPdf()"
    [showHeaderButton]="false"
    [showSearchBar]="false"
  >
    <div class="row mb-2 justify-content-between">
      <!-- Filtro de estado -->
      <div class="col-3 d-flex align-items-center">
        <label for="fineStateFilter" class="col-form-label me-2"
          >Estado:
        </label>
        <select
          id="fineStateFilter"
          class="form-select"
          name="fineStateFilter"
          [(ngModel)]="service.searchState"
        >
          <option [ngValue]="''">Todos</option>
          @for (key of service.fineStatusKeys; track $index) {
          <option [value]="key">
            {{ service.getValueByKeyForStatusEnum(key) }}
          </option>
          }
        </select>
      </div>
      <div class="col-3 d-flex align-items-center">
        <label for="dateFrom" class="col-form-label me-2">Desde:</label>
        <div class="input-group">
          <input
            class="form-control"
            placeholder="yyyy-mm-dd"
            [(ngModel)]="service.dateFrom"
            ngbDatepicker
            #dateFromPicker="ngbDatepicker"
            placement="bottom"
            name="dateFrom"
            [maxDate]="service.dateTo"
          />
          <button
            class="btn btn-outline-secondary bi bi-calendar3"
            (click)="dateFromPicker.toggle()"
            type="button"
          ></button>
        </div>
      </div>

      <div class="col-3 d-flex align-items-center">
        <label for="dateTo" class="col-form-label me-2">Hasta:</label>
        <div class="input-group">
          <input
            class="form-control"
            placeholder="yyyy-mm-dd"
            [(ngModel)]="service.dateTo"
            ngbDatepicker
            #dateToPicker="ngbDatepicker"
            placement="bottom"
            name="dateTo"
            [minDate]="service.dateFrom"
          />
          <button
            class="btn btn-outline-secondary bi bi-calendar3"
            (click)="dateToPicker.toggle()"
            type="button"
          ></button>
        </div>
      </div>
    </div>
  </app-table>
</app-main-container>
